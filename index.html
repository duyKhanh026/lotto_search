<!DOCTYPE html>
<html lang="vi">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Ph√¢n t√≠ch Lotto</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body { 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 40px 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
}

h1 {
    color: white;
    text-align: center;
    margin-bottom: 40px;
    font-size: 2.3em;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

h2 { 
    margin-top: 35px; 
    margin-bottom: 20px;
    color: white;
    font-size: 1.3em;
    background: rgba(255,255,255,0.15);
    padding: 12px;
    border-radius: 8px;
    border-left: 4px solid #ffd700;
}

.result-heading {
    color: black !important;
    background: rgba(255,255,255,0.9) !important;
}

.input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

input { 
    padding: 12px 15px;
    border: none;
    border-radius: 6px;
    font-size: 1em;
    flex: 1;
    min-width: 250px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

button { 
    padding: 12px 25px;
    border: none;
    border-radius: 6px;
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
}

button:hover {
    transform: translateY(-2px);
}

.result-box { 
    margin-top: 15px; 
    padding: 18px;
    background: rgba(255,255,255,0.97);
    border-radius: 8px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    font-size: 0.95em;
    display: none;
}

#result {
    background: rgba(255,255,255,0.97);
    border-radius: 8px;
    padding: 25px;
    margin-top: 30px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

table { 
    border-collapse: collapse; 
    margin-top: 15px; 
    width: 100%;
    background: white;
}

th, td { 
    border: 1px solid #e0e0e0;
    padding: 10px; 
    text-align: center;
    font-size: 0.9em;
}

th { 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
}

tr:nth-child(even) {
    background: #f5f7ff;
}

.table-wrapper {
    overflow-x: auto;
}

.random-numbers-container {
    background: rgba(255,255,255,0.97);
    border-radius: 8px;
    padding: 20px;
    margin-top: 15px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
    text-align: center;
}

.random-numbers-display {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 15px;
}

.random-number-box {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    width: 80px;
    height: 80px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2em;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

/* @media (max-width: 768px) {

    body { padding: 20px; }

    h1 { font-size: 1.6em; }

    table {
        font-size: 0.8em;
        min-width: 500px;
    }
} */
</style>
</head>
<body>

<div class="container">
<h1>üé∞ Ph√¢n t√≠ch k·∫øt qu·∫£ Lotto</h1>

<h2>üîç D√≤ b·ªô s·ªë</h2>
<div class="input-group">
    <input type="text" id="checkInput" placeholder="Nh·∫≠p 3-5 s·ªë v√≠ d·ª•: 12 14 22 23 30">
    <button onclick="checkSet()">Ki·ªÉm tra</button>
</div>
<div id="checkResult" class="result-box"></div>

<div id="result"></div>
</div>

<script>

let fullSetCount = {};
let tripleCount = {};
let numberFrequency = {};
let drawHistory = [];

window.onload = function() {
    fetch("lotto.txt")
    .then(response => response.text())
    .then(text => processData(text))
    .catch(err => alert("Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c file! H√£y ch·∫°y b·∫±ng http server."));
};

function processData(text) {

    const lines = text.trim().split("\n");

    lines.forEach(line => {

        const parts = line.trim().split(" ");
        if (parts.length < 3) return;

        const date = parts[0];
        const drawId = parts[1];
        const numbersPart = parts[2];
        const mainPart = numbersPart.split("|")[0];
        const special = numbersPart.split("|")[1] || "";

        let numbers = [];
        for (let i = 0; i < mainPart.length; i += 2) {
            numbers.push(mainPart.substr(i, 2));
        }

        numbers.sort();

        drawHistory.push({ date, drawId, numbers, special: special });

        const fullKey = numbers.join("-");
        fullSetCount[fullKey] = (fullSetCount[fullKey] || 0) + 1;

        numbers.forEach(num => {
            numberFrequency[num] = (numberFrequency[num] || 0) + 1;
        });

        for (let i = 0; i < numbers.length; i++) {
            for (let j = i + 1; j < numbers.length; j++) {
                for (let k = j + 1; k < numbers.length; k++) {
                    const triple = [numbers[i], numbers[j], numbers[k]].join("-");
                    tripleCount[triple] = (tripleCount[triple] || 0) + 1;
                }
            }
        }

    });

    displayResults();
}

function displayResults() {

    let html = "";

    html += "<div class='random-numbers-container'>";
    html += "<h3 style='color: #667eea;'>üé≤ S·ªë ƒë·∫∑c bi·ªát</h3>";
    html += createRandomNumbersDisplay();
    html += "</div>";

    html += "<h2 class='result-heading'>üí° G·ª£i √Ω b·ªô s·ªë ch∆∞a t·ª´ng xu·∫•t hi·ªán</h2>";
    html += createSuggestTable();

    // Display recent results from last 5 days
    const recentDates = getUniqueDates(drawHistory).slice(0, 5);
    html += "<h2 class='result-heading'>üìÖ K·∫øt qu·∫£ 5 ng√†y g·∫ßn nh·∫•t</h2>";
    html += createRecentTable(recentDates);

    const filteredFull = Object.fromEntries(
        Object.entries(fullSetCount)
        .filter(([k,v]) => v > 1)
        .sort((a,b) => b[1]-a[1])
    );

    html += "<h2 class='result-heading'>B·ªô 5 s·ªë xu·∫•t hi·ªán > 1 l·∫ßn</h2>";
    html += createTable(filteredFull);

    const filteredTriple = Object.fromEntries(
        Object.entries(tripleCount)
        .filter(([k,v]) => v > 1)
        .sort((a,b) => b[1]-a[1])
        .slice(0,50)
    );

    html += "<h2 class='result-heading'>Top b·ªô 3 xu·∫•t hi·ªán > 1 l·∫ßn</h2>";
    html += createTable(filteredTriple);

    html += "<h2 class='result-heading'>T·∫ßn su·∫•t t·ª´ng s·ªë</h2>";
    html += createTable(
        Object.fromEntries(
            Object.entries(numberFrequency)
            .sort((a,b) => b[1]-a[1])
        )
    );

    document.getElementById("result").innerHTML = html;
}

function createTable(dataObj) {

    if (Object.keys(dataObj).length === 0)
        return "<p>Kh√¥ng c√≥ d·ªØ li·ªáu</p>";

    let html = "<div class='table-wrapper'><table>";
    html += "<tr><th>B·ªô s·ªë</th><th>S·ªë l·∫ßn</th></tr>";

    for (const key in dataObj) {
        html += `<tr><td>${key}</td><td>${dataObj[key]}</td></tr>`;
    }

    html += "</table></div>";
    return html;
}

function getUniqueDates(history) {
    const dateMap = new Map();
    history.forEach(draw => {
        if (!dateMap.has(draw.date)) {
            dateMap.set(draw.date, []);
        }
        dateMap.get(draw.date).push(draw);
    });
    
    return Array.from(dateMap.keys());
}

function createRecentTable(dates) {
    let html = "<div class='table-wrapper'><table>";
    html += "<tr><th>Ng√†y</th><th>K·ª≥</th><th>B·ªô s·ªë</th></tr>";

    dates.forEach(date => {
        const drawsForDate = drawHistory.filter(d => d.date === date);
        drawsForDate.forEach(draw => {
            html += `<tr>
                <td>${draw.date}</td>
                <td>${draw.drawId}</td>
                <td>${draw.numbers.join(" ")} | ${draw.special || "-"}</td>
            </tr>`;
        });
    });

    html += "</table></div>";
    return html;
}

function generateRandomSets() {
    const existingSets = new Set(Object.keys(fullSetCount));
    const suggestedSets = [];
    
    while (suggestedSets.length < 5) {
        const numbers = [];
        
        // Generate 5 random numbers from 1-35
        while (numbers.length < 5) {
            const num = Math.floor(Math.random() * 35) + 1;
            const numStr = String(num).padStart(2, '0');
            if (!numbers.includes(numStr)) {
                numbers.push(numStr);
            }
        }
        
        numbers.sort();
        const setKey = numbers.join("-");
        
        // Only add if this set has never appeared before
        if (!existingSets.has(setKey)) {
            suggestedSets.push(setKey);
        }
    }
    
    return suggestedSets;
}

function generateRandomNumbers() {
    const randomNumbers = [];
    while (randomNumbers.length < 3) {
        const num = Math.floor(Math.random() * 12) + 1;
        if (!randomNumbers.includes(num)) {
            randomNumbers.push(num);
        }
    }
    return randomNumbers;
}

function createRandomNumbersDisplay() {
    const numbers = generateRandomNumbers();
    let html = "<div class='random-numbers-display'>";
    
    numbers.forEach(num => {
        html += `<div class='random-number-box'>${String(num).padStart(2, '0')}</div>`;
    });
    
    html += "</div>";
    return html;
}

function createSuggestTable() {
    const suggestedSets = generateRandomSets();
    
    let html = "<div class='table-wrapper'><table>";
    html += "<tr><th>STT</th><th>B·ªô s·ªë g·ª£i √Ω</th></tr>";

    suggestedSets.forEach((set, index) => {
        html += `<tr>
            <td>${index + 1}</td>
            <td>${set}</td>
        </tr>`;
    });

    html += "</table></div>";
    return html;
}

function checkSet() {

    const input = document.getElementById("checkInput").value.trim();
    if (!input) return;

    let numbers = input.split(/\s+/);

    if (numbers.length < 3 || numbers.length > 5) {
        showResult("‚ö†Ô∏è Nh·∫≠p t·ª´ 3 ƒë·∫øn 5 s·ªë!", false);
        return;
    }

    numbers = numbers.map(n => n.padStart(2,'0')).sort();

    let matchedDraws = [];

    drawHistory.forEach(draw => {
        const containsAll = numbers.every(num =>
            draw.numbers.includes(num)
        );
        if (containsAll) matchedDraws.push(draw);
    });

    if (matchedDraws.length > 0) {

        let html = `
        ‚úÖ T·ªï h·ª£p <strong>${numbers.join("-")}</strong> xu·∫•t hi·ªán 
        <strong>${matchedDraws.length}</strong> k·ª≥
        <br><br>
        <div class="table-wrapper">
        <table>
        <tr>
            <th>Ng√†y</th>
            <th>K·ª≥</th>
            <th>B·ªô s·ªë</th>
        </tr>`;

        matchedDraws.forEach(draw => {
            html += `
            <tr>
                <td>${draw.date}</td>
                <td>${draw.drawId}</td>
                <td>${draw.numbers.join(" ")}</td>
            </tr>`;
        });

        html += "</table></div>";

        showResult(html, true);

    } else {
        showResult(
            `‚ùå T·ªï h·ª£p ${numbers.join("-")} ch∆∞a t·ª´ng xu·∫•t hi·ªán`,
            false
        );
    }
}

function showResult(content, success) {

    const box = document.getElementById("checkResult");
    box.style.display = "block";
    box.innerHTML = content;

    if (success) {
        box.style.borderLeft = "6px solid #28a745";
    } else {
        box.style.borderLeft = "6px solid #dc3545";
    }
}

</script>

</body>
</html>